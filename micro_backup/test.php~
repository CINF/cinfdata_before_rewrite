<?
include("../common_functions.php");
include("graphsettings.php");
$db = std_db();
$type = $_GET["type"];

$settings = plot_settings($type); // This will be overridden, we just need to know what type-number to extract from the database


//$exported_ids is the list of ids that is going to be plotted. This is either the idlist from the url or the latest measurement
$exported_ids = $_GET["idlist"];

// Get metdata for each plot and produce the id-list for the plot
$html_formatted_idlist = "";
foreach($exported_ids as $curr_id){
    $param["id"] = $curr_id;
    $html_formatted_idlist = $html_formatted_idlist . "&idlist[]=" . $curr_id;
    
    $settings = plot_settings($type,$param); 

    $meta_informations[$curr_id]["query"] = $settings["query"];
}


foreach($meta_informations as $id_key => $meta){
    $data[$id_key] = get_xy_values($meta["query"],$db);
}

$ref_data = $data[372];
$cur_data  =$data[370];
for($i=1;$i<count($cur_data["x"]);$i++){
    $n = 0;
    while($ref_data["x"][$n]<$cur_data["x"][$i]){
        $n++;
    }
    echo($n . " Ref: " . $ref_data["x"][$n] . " Cur: " . $cur_data["x"][$i] . "<br>");
}


//header('Content-type: text/plain');

//foreach($data as $id_key => $curr_data){
//    for($i=0;$i<count($curr_data["x"]);$i++){
//        $finaldata[$i] = $finaldata[$i] . "\"" . $curr_data["x"][$i] . "\"\t\"" . $curr_data["y"][$i] . "\"\t";
//    }
//}
//for($i=0;$i<count($finaldata);$i++){
//    echo($finaldata[$i] . "\n");
//}
?>
